# install script to make sure the environment is properly setup 

# things to do: 

#  create symlinks from install directory to virtuoso installation
# set up the config file with the appropriate values
# help configure the virtuso.ini file

source config.cfg

# We need a name to call our instance of virtuoso. Hopefully there is no 
# clash with other named instances as this will cause trouble with start/stopping
# of instances
echo "Do we have a name for this virtuoso instance?"
if [ ! $virtuoso ]; then
	echo " -> Nope. set this in configuration file "
	exit 1
else
	echo " -> Yup. $virtuoso"
fi

# Is in the installation directory for virtuoso set?
echo "Checking for virtuoso directory using config"
if [ ! $virtuoso_home ]; then
	echo " -> Nope. Set your virtuoso=/path/to/virtuoso/directory/not/bin to proceed."
	exit 1
else
	echo " -> Found virtuoso directory creating symlinks now:"
	echo " --> $virtuoso"
		ln -s ${virtuoso_home}/bin/virtuoso-t ${virtuoso} &> /dev/null
	echo " --> isql"
		ln -s ${virtuoso_home}/bin/isql isql  &> /dev/null
fi

echo "checking we can find a virtuoso.ini file"
if [ ! -f $virtuoso_ini ]; then
	echo " -> Nope. virtuoso ini file needs to be configured in the config file "
	exit 1
else
	echo "Found virtuoso.ini file"
	echo "Using to configure port numbers"
	port=$(grep -m 1 ServerPort.*\=\ [0-9]*$ virtuoso.ini | awk '{ split($0,a," "); print a[3] }')

	if [ $port ]; then
		echo "setting port to $port"
		cmd="s/isql_port=.*$/isql_port=$port/"
		sed -i0 ${cmd} config.cfg
	else
		echo "did not find port. you will need to configure manually"
		exit 1
	fi

fi


# set the port variable in the virtuoso.ini file to the one specified in the 
# config